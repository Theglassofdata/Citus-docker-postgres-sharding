# ğŸŸ£ Citus Cluster with Streaming Replication and Connection Pool (Docker Compose)

---

## ğŸ”¹ Introduction

This project sets up a **highly scalable and reliable Postgres ecosystem** using:

- [**Citus**](https://github.com/citusdata/citus) for distributed sharding across multiple nodes.
- **Streaming Replication** for redundancy and high availability.
- [**PgBouncer**](https://www.pgbouncer.org/) for lightweight connection pooling.
- [**etcd**] for service configuration and orchestration.

---

## ğŸ”¹ Why?

âœ… **Scalable:** Easily add more workers to handle growing workloads.  
âœ… **Highly Available:** Standby nodes follow their primaries and take over if a primary fails.  
âœ… **Efficient:** PgBouncer efficiently multiplexes numerous client requests into a small pool of Postgres backends.

---

## ğŸ”¹ Architectural Diagram

![Add your architecture screenshot here]

---

## ğŸ”¹ Cluster Summary (Docker Compose)

```shell
â¥ coordinator_citus (Primary, port 5432)
â¥ worker_citus1 (Primary, port 5432)
â¥ worker_citus2 (Primary, port 5432)

â¥ worker_citus1_standby (Standby for worker 1, port 5432)
â¥ worker_citus2_standby (Standby for worker 2, port 5432)

â¥ pgbouncer (connection pooler, port 6432)

â¥ etcd (used for service coordination)

ğŸ”¹ Operations Performed
âœ… Checked readiness: All services were up and healthy.
âœ… Clean-up: Removed existing shards and metadata to start from a clean state.
âœ… Initiated Citus:

Added workers to the coordinator

Distributed a table

Loaded sample data
âœ… Checked Shards: Verified shards were distributed across workers.
âœ… Checked Replication: Confirmed primary and standby were in streaming state.
âœ… Set up Standbys: Standby containers were restarted to follow their respective primaries.
âœ… Connection Pool: PgBouncer initialized to handle heavy client workloads.

ğŸ”¹ Access
To connect directly to Coordinator:

shell
Copy
Edit
psql -h localhost -p 5432 -U postgres -d postgres
To connect through PgBouncer:

shell
Copy
Edit
psql -h localhost -p 6432 -U postgres -d postgres
ğŸ”¹ Screenshots (Add your own)
Citus Cluster Initializing
![Add your screenshot here]

Shards Distribution
![Add your screenshot here]

Streaming Replication
![Add your screenshot here]

Connection Pool (PgBouncer) in Action
![Add your screenshot here]

ğŸ”¹ Final Notes
âœ… The Docker Compose files and shell scripts (setup-citus-cluster.sh and setup-replication.sh) automate all these steps.

âœ… The cluster is now ready to handle distributed workloads with redundancy and scalable connection handling.

ğŸš€ If youâ€™d like, you can:

Provide a small â€œcheat sheetâ€ of psql commands

Include backup or failover instructions

Expand this to multi-datacenter or multi-region

vbnet
Copy
Edit

âœ… Now you can **copy this directly into your `README.md`**.  
âœ… Feel free to **paste your own screenshots** into the placeholders afterwards.  

If you'd like, I can:
- Provide a psql cheat sheet
- Failover instructions
- or even a small architecture SVG

Just let me know!







